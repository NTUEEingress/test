
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - trackball controls</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			color: #000;
			font-family:Monospace;
			font-size:15px;
       			text-align:center;
       			font-weight: bold;
       			background-color: #fff;
			margin: 0px;
			overflow: hidden;
		}

		#info {
			color:#000;
			position: absolute;
			top: 0px; width: 100%;
			padding: 5px;
		}		

		a {
			color: red;
		}
	</style>
</head>

<body>
	<div id="container"></div>
	<div id="info">
	<a href="http://threejs.org" target="_blank">three.js</a> - trackball controls example</br>
MOVE mouse &amp; press LEFT/A: rotate, MIDDLE/S: zoom, RIGHT/D: pan
	</div>

		<script src="../build/three.min.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<script src="js/controls/TrackballControls.js"></script>
		<script src="js/renderers/Projector.js"></script>
		<script src="js/Detector.js"></script>
		<script>
		
		if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
		
		var container, stats;
		
		var camera, controls, scene, renderer, raycaster;
		
		var mouse_click = new THREE.Vector2(),INTERSECTED_M,INTERSECTED_C;
		var mouse_move = new THREE.Vector2();
		var tmp=0;
		var cross;
		
		init();
		animate();
		
		function init() {
		
			camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
			camera.position.z = 500;
		
			controls = new THREE.TrackballControls( camera );
		
			controls.rotateSpeed = 1.2;
			controls.zoomSpeed = 1.0;
			controls.panSpeed = 0.8;
		
			controls.noZoom = false;
			controls.noPan = false;
		
			controls.staticMoving = true;
			controls.dynamicDampingFactor = 0.3;
		
			controls.keys = [ 65, 83, 68 ];
		
			controls.addEventListener( 'change', render );
		
			// world
		
			scene = new THREE.Scene();
			scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );
		
			var geometry_circle = new THREE.CircleGeometry(40,32);
		
			for(var i=0;i<5;i++){
				var mesh_circle = new THREE.Mesh(geometry_circle,new THREE.MeshBasicMaterial( { color: 'blue'} ));
		
				mesh_circle.position.x = Math.random() * 480 - 240;
				mesh_circle.position.y = Math.random() * 480 - 240;
				scene.add(mesh_circle);
			}	
		
			raycaster = new THREE.Raycaster();
			//mouse
			document.addEventListener('mousedown',onDocumentMouseDown,false);
			document.addEventListener('mousemove',onDocumentMouseMove,false);
			projector = new THREE.Projector();	
		
		
			// lights
		
		
		
			light = new THREE.AmbientLight( 0x222222 );
			scene.add( light );
		
		
			// renderer
		
			renderer = new THREE.WebGLRenderer( { antialias: false } );
			renderer.setClearColor( scene.fog.color );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
		
		
			container = document.getElementById( 'container' );
			container.appendChild( renderer.domElement );
		
			stats = new Stats();
			stats.domElement.style.position = 'absolute';
			stats.domElement.style.top = '0px';
			stats.domElement.style.zIndex = 100;
			container.appendChild( stats.domElement );
		
			//
		
			window.addEventListener( 'resize', onWindowResize, false );
			//
		
			render();
		
		}
		
		function onWindowResize() {
		
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
		
			renderer.setSize( window.innerWidth, window.innerHeight );
		
			controls.handleResize();
		
			render();
		
		}
		function onDocumentMouseMove(event){
		
			event.preventDefault();
		
			mouse_move.x = ( event.clientX / window.innerWidth ) * 2 - 1;
			mouse_move.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
			mouse_click.x=1;
			mouse_click.y=1;
			tmp=0;
		}
		function onDocumentMouseDown( event ) {
		
			event.preventDefault();
		
			console.log("Click.");
		
			mouse_click.x = ( event.clientX / window.innerWidth ) * 2 - 1;
			mouse_click.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
		}
		function animate() {
		
			requestAnimationFrame( animate );
			controls.update();
			//render_move();
			render_click();
		}
		
		function render_move(){
		
			//find intersection_move
			raycaster.setFromCamera(mouse_move,camera);
			var intersect_move = raycaster.intersectObjects(scene.children)
		
				if ( intersect_move.length > 0 ) {
		
					if ( INTERSECTED_M ) INTERSECTED_M.material.color.setHex( INTERSECTED_M.currentHex );
					console.log("10231654520");
					INTERSECTED_M = intersect_move[ 0 ].object;
					INTERSECTED_M.currentHex = INTERSECTED_M.material.color.getHex();
					INTERSECTED_M.material.color.setHex( 0x00ff00 );
		
				}
		
			renderer.render(scene,camera);
		}
		function render_click(){
			raycaster.setFromCamera(mouse_click,camera);
			var intersect_click = raycaster.intersectObjects(scene.children)
		
				if ( intersect_click.length > 0 && tmp==0) {
		
					INTERSECTED_C = intersect_click[ 0 ].object;
					INTERSECTED_C.currentHex = INTERSECTED_C.material.color.getHex();
					if(INTERSECTED_C.currentHex == 0xff0000) INTERSECTED_C.material.color.setHex( 0x0000ff );
					else if(INTERSECTED_C.currentHex == 0x0000ff)INTERSECTED_C.material.color.setHex( 0xff0000 );
		
					for(var i=0;i<5;i++){
						if(scene.children[i].material.color.getHex()==INTERSECTED_C.material.color.getHex() && scene.children[i]!=INTERSECTED_C){
							var line = new THREE.LineBasicMaterial({color: scene.children[i].material.color.getHex()});
							var geo=new THREE.Geometry();
							geo.vertices.push(
									new THREE.Vector3(scene.children[i].position.x,scene.children[i].position.y,0),new THREE.Vector3(INTERSECTED_C.position.x,INTERSECTED_C.position.y,0) );
							var LINE =new THREE.Line(geo,line);
							scene.add(LINE);
							console.log("C");
						}
					}
					/*if(scene.children.length>5){var obj =scene.children[6];
						scene.remove(obj);}*/								
		
		
		
		for(var i=0;i<5;i++){
			if(scene.children[i].material.color.getHex()!=INTERSECTED_C.material.color.getHex()&& scene.children[i]!=INTERSECTED_C){
		for(var j=6;j<scene.children.length;j++){
			if(scene.children[j].geometry.vertices[0].x==scene.children[i].position.x && scene.children[j].geometry.vertices[0].y==scene.children[i].position.y && scene.children[j].geometry.vertices[1].x==INTERSECTED_C.position.x && scene.children[j].geometry.vertices[1].y==INTERSECTED_C.position.y ||scene.children[j].geometry.vertices[1].x==scene.children[i].position.x && scene.children[j].geometry.vertices[1].y==scene.children[i].position.y && scene.children[j].geometry.vertices[0].x==INTERSECTED_C.position.x && scene.children[j].geometry.vertices[0].y==INTERSECTED_C.position.y){
					var obj=scene.children[j];
						scene.remove(obj);
		}}}}
		
					tmp=1;			
					console.log(scene);
				}	
			renderer.render(scene,camera);
		}
		function render() {
		
			renderer.render( scene, camera );
			stats.update();
		
		}
		
`		</script>	
	</body>
</html>

